<story-context id="6-3-verify-email-and-rag-functionality" v="1.0">
  <metadata>
    <epicId>epic-6</epicId>
    <storyId>6.3</storyId>
    <title>Verify Email and RAG Functionality</title>
    <status>drafted</status>
    <generatedAt>2025-11-24</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/stories/6-3-verify-email-and-rag-functionality.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>developer</asA>
    <iWant>to verify that the core AI and email features work correctly in the production environment</iWant>
    <soThat>I can confidently sign off on the release</soThat>
    <tasks>
- [ ] **Smoke Test: Lead Generation** (AC: 1)
  - [ ] Go to Contact section.
  - [ ] Fill out form with test data.
  - [ ] Submit.
  - [ ] Check backend logs (Vercel Dashboard) for `[Email] Sent successfully`.
  - [ ] Check inbox for the email.

- [ ] **Smoke Test: RAG Chat** (AC: 2)
  - [ ] Open Chat.
  - [ ] Ask "Who is Vansh?".
  - [ ] Verify response cites personal context.
  - [ ] Ask "Tell me about Aether".
  - [ ] Verify response cites Aether project context (if in Aether overlay) or general context.

- [ ] **Error Handling Verification**
  - [ ] Test offline behavior (disconnect network, try to send).
  - [ ] Test empty/invalid inputs.
    </tasks>
  </story>

  <acceptanceCriteria>
1. **Given** the live production site
   * **When** I send a contact form submission
   * **Then** the backend processes the request successfully (200 OK).
   * **And** I receive an actual email at the configured address (e.g., `design@vansh.fyi` or testing alias).

2. **Given** the live production site
   * **When** I ask Ursa a question in the chat
   * **Then** I receive a relevant, context-aware response generated by the RAG system.
   * **And** the response time is within acceptable limits (&lt; 5-10s).

3. **Given** the live production site
   * **When** I navigate between different projects
   * **Then** the chat context updates correctly (verified by asking project-specific questions).
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic 6: Backend Deployment &amp; API Integration</title>
        <section>Story 6.3</section>
        <snippet>Verify Email and RAG Functionality.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture</title>
        <section>Technology Stack Details</section>
        <snippet>Frontend: React (Vite), Backend: Vercel AI SDK (TypeScript) with HuggingFace provider, API: tRPC, Email: Resend.</snippet>
      </doc>
    </docs>
    <code>
      <file>
        <path>vansh.fyi/src/services/trpc.tsx</path>
        <kind>service</kind>
        <symbol>trpc</symbol>
        <lines>1-37</lines>
        <reason>tRPC client configuration - critical for connecting to backend.</reason>
      </file>
      <file>
        <path>backend/api/trpc/[...path].ts</path>
        <kind>server-entry</kind>
        <symbol>handler</symbol>
        <reason>Backend tRPC handler - entry point for API requests.</reason>
      </file>
      <file>
        <path>backend/src/api/rag.ts</path>
        <kind>router</kind>
        <symbol>ragRouter</symbol>
        <reason>RAG router definition - handles chat queries.</reason>
      </file>
      <file>
        <path>backend/src/api/email.ts</path>
        <kind>router</kind>
        <symbol>emailRouter</symbol>
        <reason>Email router definition - handles lead submission.</reason>
      </file>
    </code>
    <dependencies>
      <ecosystem name="node">
        <package name="resend" version="^6.5.2" />
        <package name="@trpc/client" version="^11.7.2" />
        <package name="@ai-sdk/huggingface" version="^0.0.4" />
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Verification MUST be done on the live production site (`https://portfolio2-0-backend-blond.vercel.app`)</constraint>
    <constraint>Requires valid `RESEND_API_KEY` and `HUGGINGFACE_API_KEY` in Vercel production environment</constraint>
    <constraint>Requires `VITE_API_URL` set correctly in frontend Vercel project</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>RAG Query</name>
      <kind>tRPC Mutation</kind>
      <signature>trpc.rag.query({ query: string, context: 'personal' | 'project', projectId?: string })</signature>
      <path>backend/src/api/rag.ts</path>
    </interface>
    <interface>
      <name>Send Lead</name>
      <kind>tRPC Mutation</kind>
      <signature>trpc.email.sendLead({ name: string, email: string, message: string })</signature>
      <path>backend/src/api/email.ts</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Manual verification (Smoke Testing) is the primary method for this story as it targets production environment validation.
    </standards>
    <locations>
      <location>Production URL</location>
      <location>Vercel Logs</location>
    </locations>
    <ideas>
      <idea id="1">Submit contact form with valid data and verify email receipt</idea>
      <idea id="2">Submit contact form with invalid email format and verify error</idea>
      <idea id="3">Ask general question to Ursa and verify RAG response</idea>
      <idea id="4">Ask project-specific question and verify context-aware response</idea>
    </ideas>
  </tests>
</story-context>
