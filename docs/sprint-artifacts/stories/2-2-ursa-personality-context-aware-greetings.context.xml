<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>2</epicId>
    <storyId>2.2</storyId>
    <title>Ursa Personality Implementation & Context-Aware Greetings</title>
    <status>drafted</status>
    <generatedAt>2025-11-18</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/stories/2-2-ursa-personality-context-aware-greetings.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>developer</asA>
    <iWant>implement the "Ursa" personality in RAG responses and add context-aware greeting messages</iWant>
    <soThat>the agent feels authentic and engaging</soThat>
    <tasks>
- [ ] **Task 1: Implement Context-Aware Greetings** (AC: #2, #3, #4)
  - [ ] In `ChatOverlay.tsx`, add a `useEffect` that runs when the component mounts.
  - [ ] Inside the effect, check the `chatContext` from the `useViewStore`.
  - [ ] If the context is 'personal', add the personal greeting to the `messages` state.
  - [ ] If the context is 'project', add the project-specific greeting to the `messages` state.
  - [ ] The project name can be retrieved from a (to-be-created) data source based on the `projectId`.

- [ ] **Task 2: Configure Ursa Personality** (AC: #1)
  - [ ] This task is dependent on the backend Mastra.AI agent being set up (Epic 4).
  - [ ] Create a personality guide document for Ursa based on the PRD.
  - [ ] Use the personality guide to configure the system prompt for the Mastra.AI agent.
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">
      <given>the RAG backend</given>
      <when>I configure the Mastra.AI agent personality</when>
      <then>all responses reflect the tone, voice, and vocabulary defined in the Ursa personality guide</then>
    </criterion>
    <criterion id="2">
      <and>when the chat view opens in personal context, the agent displays a greeting: "Hi! I'm Ursa. Ask me anything about Vansh."</and>
    </criterion>
    <criterion id="3">
      <and>when the chat view opens in project context, the agent displays a project-specific greeting: "Hello! Ask anything about [Project Name] here."</and>
    </criterion>
    <criterion id="4">
      <and>the greeting message adapts if the user switches projects</and>
    </criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/PRD.md</path>
        <title>Product Requirements Document</title>
        <section>Ursa's Personality</section>
        <snippet>Ursa's personality should mirror Vansh's own writing style, making interactions feel like a direct conversation with him. The key characteristics are: Tone: Conversational, authentic, and passionate. Voice: Strongly first-person ("I"). Vocabulary: Clear, direct language with informal touches. Narrative Flow: Sentences should create a narrative. Visuals: Strategic use of any emoji that fits the situation.</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic Breakdown</title>
        <section>Story 2.2: Ursa Personality Implementation & Context-Aware Greetings</section>
        <snippet>As a developer, I want to implement the "Ursa" personality in RAG responses and add context-aware greeting messages, so that the agent feels authentic and engaging.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>portfolio-react-template/src/components/overlays/ChatOverlay.tsx</path>
        <kind>component</kind>
        <symbol>ChatView</symbol>
        <reason>This component will be modified to display the context-aware greetings.</reason>
      </artifact>
      <artifact>
        <path>portfolio-react-template/src/state/overlayStore.ts</path>
        <kind>store</kind>
        <symbol>useViewStore</symbol>
        <reason>This store provides the 'chatContext' and 'projectId' needed to determine which greeting to display.</reason>
      </artifact>
    </code>
    <dependencies>
        <trpc-client comment="Type-safe tRPC client for API calls">@trpc/client</trpc-client>
        <trpc-react-query comment="React Query integration for tRPC">@trpc/react-query</trpc-react-query>
        <tanstack-react-query comment="React Query (comes with tRPC, handles server state)">@tanstack/react-query</tanstack-react-query>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>The implementation of the Ursa personality in RAG responses is dependent on the backend Mastra.AI agent being set up (Epic 4).</constraint>
  </constraints>
  <interfaces>
    <interface>
      <name>useViewStore (Zustand)</name>
      <kind>Zustand store hook</kind>
      <signature>
        interface ViewStore {
          currentView: 'main' | 'projects' | 'chat';
          chatContext: 'personal' | 'project';
          initialChatQuery: string;
          projectId?: string;
          goToChat: (query?: string) => void;
          goToProjectChat: (projectId: string, query?: string) => void;
          goToMain: () => void;
          goToProjects: () => void;
        }
      </signature>
      <path>portfolio-react-template/src/state/overlayStore.ts</path>
    </interface>
  </interfaces>
  <tests>
    <standards>
      Testing framework: Jest with React Testing Library. Tests co-located in __tests__/ directories next to source files.
    </standards>
    <locations>
      portfolio-react-template/src/components/overlays/__tests__/ChatOverlay.test.tsx (EXISTING - may need updates)
    </locations>
    <ideas>
      <test ac="2">Test that the personal greeting is displayed when the chat view is opened in personal context.</test>
      <test ac="3">Test that the project-specific greeting is displayed when the chat view is opened in project context.</test>
      <test ac="4">Test that the greeting message adapts if the user switches projects.</test>
    </ideas>
  </tests>
</story-context>
